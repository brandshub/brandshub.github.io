<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="css/pickmeup.css">
	<link rel="stylesheet" href="css/common.css"> 
	
    <title>brand</title>
  </head>
  <body style="background-color:#212529;" class="text-light">
  <nav class="navbar navbar-nav navbar-expand-lg  bg-dark text-light justify-content-center" style="padding:0" >
  <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>-->
  <div id="navbarSupportedContent" class="bg-dark text-light">   
    <ul class="navbar-nav mr-auto nav justify-content-center mx-auto">
		<li class="nav-item my-auto">
                <a class="nav-link navbar-brand mx-0 d-inline text-light" href="https://brandshub.github.io">brand</a>
            </li>
      <li class="nav-item dropdown ">
        <a class="nav-link dropdown-toggle text-light bg-dark" href="#" id="navbarProfileDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Profile
        </a>
        <div class="dropdown-menu  bg-dark text-light" aria-labelledby="navbarProfileDropdown">
          <a class="dropdown-item  bg-dark text-light" href="https://github.com/brandshub"><img src="./icons/gh.png" class="favico" />GitHub</a>
          <a class="dropdown-item  bg-dark text-light" href="http://uk.dotabuff.com/players/196272157"><img src="./icons/db.png" class="favico" />DotaBuff</a>    
        </div>
      </li>
	<li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle text-light bg-dark" href="#" id="navbarLinksDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Dev
        </a>
        <div class="dropdown-menu"  id="rd" aria-labelledby="navbarLinksDropdown">
		  <a class="dropdown-item text-light bg-dark" href="https://getbootstrap.com/docs/4.3/components/alerts/"><img src="./icons/bootstrap.png" class="favico" />Bootstrap</a>			
		  <a class="dropdown-item text-light bg-dark" href="https://dotnetfiddle.net/"><img src="./icons/cs.png" class="favico" />C# Online Compiler</a>		
		  <a class="dropdown-item text-light bg-dark" href="https://www.campaignmonitor.com/css/"><img src="./icons/css.png" class="favico" />CSS Support</a>
		  <a class="dropdown-item text-light bg-dark" href="https://htmlfiddle.net/"><img src="./icons/html.png" class="favico" />HTML Snippets</a>		  
		  <a class="dropdown-item text-light bg-dark" href="https://regex101.com/"><img src="./icons/rgx.png" class="favico" />Regex Tester</a>       
		  <a class="dropdown-item text-light bg-dark" href="https://www.freeformatter.com/sql-escape.html"><img src="./icons/xml.png" class="favico" />SQL Escape</a>       
        </div>
      </li>
	  <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle text-light bg-dark" href="./utilities.html" id="navbarUtilityDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Finance
        </a>
        <div class="dropdown-menu text-light bg-dark" id="rl" aria-labelledby="navbarUtilityDropdown">
		  <a class="dropdown-item text-light bg-dark" href="https://drive.google.com/open?id=1RNN-JeCMIfzSXf4A33fUsHP3HfrNegLK2md1qX476RU"><img src="./icons/googleSpreadsheet.ico" width="16" height="16" class="favico" />My Data</a>		
		  <h6 class="dropdown-header text-light bg-dark">Resources</h6>
		  <a class="dropdown-item text-light bg-dark" href="https://104.ua/ua/"><img src="./icons/104.png" class="favico" />104.ua</a>
		  <a class="dropdown-item text-light bg-dark" href="https://pay.kyivstar.ua/"><img src="./icons/kyivstar.png" class="favico" />Kyivstar</a>
		  <a class="dropdown-item text-light bg-dark" href="http://vodarivne.com/"><img src="./icons/voda.png" class="favico" />Rivneoblvodokanal</a>
		  <a class="dropdown-item text-light bg-dark" href="https://my.roe.vsei.ua/cabinet/login/"><img src="./icons/roe.png" class="favico" />Rivneoblenergo</a>
		  <a class="dropdown-item text-light bg-dark" href="https://my.ez.rv.ua/cabinet/login/"><img src="./icons/roek.png" class="favico" />ROEK</a>
		  <a class="dropdown-item text-light bg-dark" href="https://my.volia.com/rovno/uk/cockpit/dashboard"><img src="./icons/volia.png" class="favico" />Volia</a>		  
        </div>
      </li>	  
    </ul>
  </div>
  </nav>  
    <div class="container">
		<div class="row pb-3">
			<div class="col-12 justify-content-center text-center">
				<div style="width:208px;font-size:10px" class="text-right d-inline-block" id="usdDiv">
				
				</div>
			</div>
		</div>
		<div class="row justify-content-center">
			<div class="col-12 text-center">
				<h2  class="text-center" id="currentTime">00:00:00</h2>
			</div>
		</div>
		<div class="row justify-content-center">
			<div class="col-12 text-center">
				<h5  class="text-center" id="currentDate">Monday, 32 February</h5>
			</div>
		</div>	
		<div class="row pt-3 justify-content-center">
			<div class="col-12 justify-content-center  text-center" id="cla">
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row text-center justify-content-center pt-4" ><h4 class="text-center" id="covidLbl" >COVID-19 Data</h4></div>
		<div class="row pt-3 justify-content-center text-center col-12 col-xl-6" style="word-break:break-word;margin:auto" id="covidGrid">		
			<!--<div class="col-12 col-xl-6  justify-content-center  text-center" >
			 <object data="img/Ukraine.svg" type="image/svg+xml"
			 id="mapSvg" style="height:auto;width:100%"></object>
			</div>-->
		</div>
		<div  class="row" style="height:75px"></div>
	</div>
	</div>
	<nav id="liesPerDay" class="navbar navbar-nav fixed-bottom navbar-expand-lg  bg-dark text-light justify-content-center px-1 py-1" style="font-size:12px;display:none">
	<span>If you are a woman, click 
		<a class="bg-dark text-light justify-content-center" href="https://brandshub.github.io/lietome" style="text-decoration:underline">here</a>.
		</span>
	</nav>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>	
	<script src="js/pickmeup.js" ></script>
	<script src="js/jquery.pickmeup.twitter-bootstrap.js" ></script>
	<script src="js/common.js" ></script>
	<script src="js/covid19.js" ></script>
	<script>
	
	var daysInWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
	var month= ["January","February","March","April","May","June","July","August","September","October","November","December"];
	var dates = [
	{ date:'09/09', name:'serhiy'}, 
	{ date:'05/07', name:'Lena'},
	{ date:'05/07', name:'Plyuhin'},
	{ date:'10/04', name:'0lya'}, 
	{ date:'13/11', name:'0xana'}, 
	{ date:'03/02', name:'Taras'} , 
	{ date:'01/02', name:'Vadim'}, 
	{ date:'03/12', name:'Ivanka'}, 
	{ date:'15/07', name:'Elvis'}, 
	{ date:'04/02', name:'Muhal\''},
	{ date:'02/08', name:'Illya'},
	{ date:'13/03', name:'Yarik'}
	];	
	
	var baseRegions = ['Rivne','Kyiv','Lviv'];
	var covidSelDate = '';

	$(function() {	
				   if(showLiesFooter()) {
					 $('#liesPerDay').show();
				   }
				   
				   timerTick();
					
				   var div = $('#cla');
				   div.pickmeup_twitter_bootstrap({mode	: 'multiple'});
				   pickmeup('#cla').show();					
				   
				   div[0].addEventListener('pickmeup-hide', function (e) {
						e.preventDefault(); 
					});					

					div.append($('.pmu-instance').parent());					
					
					refreshTooltips();
					
					$('.pmu-instance').on('click', '.pmu-days div', function() {
					  if($(this).hasClass('pmu-not-in-month'))
						return;
					   let dt = pickmeup('#cla').get_current();
					   let month = dt.getMonth()+1;
					   let year = dt.getFullYear();
					   let dday =  parseInt($(this).text());
					   
					   let frmt  = year+'-'+d2(month)+'-'+d2(dday);
					   let newDt = new Date(frmt+' 00:00');					   
					   covidSelDate = frmt;
						
					   if(newDt < new Date()) {					   
						   console.log(frmt);
						   covidSelDate = frmt;
						   
						   var cvObj = window['CV_allByDate'];
						   if(!cvObj || !cvObj[frmt])
							   covidGetByDate(frmt,function(dateStr, data) { renderDataForDate(dateStr, data, window.expUkFlag ?  baseRegions: null );});
						   else
								renderDataForDate(frmt, cvObj[frmt],  window.expUkFlag ? ['Rivne','Kyiv','Lviv'] : null );
						}
						else {
							renderDataForDate(frmt,null);
						}
					
					});	
					
					window.expUkFlag = true;
					covidSelDate = toCovidDate(new Date());					
					covidGetToday(function(dateStr, data) { renderDataForDate(dateStr, data,  window.expUkFlag ? baseRegions : null );});
					
					$('.pmu-instance').on('click', '.pmu-button', function() {
						if(!$(this).parent().hasClass('pmu-days')) {								
								setTimeout(refreshTooltips,50);
							}});						
					
					$('#covidGrid').on('click','#expUk',function(e) {
						var state = $(this).hasClass('expoff');
						window.expUkFlag = !state;
						
						$(this).toggleClass('expoff').toggleClass('expon').text(state ? '(—)' : '(+)');
						
						getCovidForSelectedDate();
					});
					
					
					var $rate = $.getJSON('https://jsonp.afeld.me/?callback=?&url=http://rulya-bank.com.ua/', function(data){
						var text = data.data;					
						var rgx = /USD\<\/font\>\<b\>\<\/td\>\s+?\<td\sclass\=\"tbl\"\s+?align\=\"center\"\>\<b\>([\.\d]+)\<\/b\>\<\/td\>\s+?\<td\sclass\=\"tbl\"\s*?align\=\"center\"\>\<b\>([\.\d]+)\<\/b\>\<\/td\>/igs;
						var obj = rgx.exec(text);
						$('#usdDiv').text('USD '+obj[1]+' / '+obj[2]);						
					});
					setTimeout(function(){ $rate.abort(); }, 7000);
  
  
  
  
  
					setInterval(timerTick,500);
		});
		
		
		function timerTick() {
			var d = new Date();
			var timeStr = d2(d.getHours())+':'+d2(d.getMinutes())+':'+d2(d.getSeconds());
			var dateStr = daysInWeek[d.getDay()]+', '+d2(d.getDate())+' '+month[d.getMonth()];
			$('#currentTime').text(timeStr);
			$('#currentDate').text(dateStr);			
		}
		
		
		function d2(n){ return n<10?('0'+n):n; }
		
		function refreshTooltips() {
			var options = document.getElementById('cla').__pickmeup.options;
			var monthDate = options.current.getMonth();
			console.log(options);
			var selectedDates = [];
			var selectedNames = [];
			for(var i=0;i<dates.length;i++) {
				var dt = dates[i].date;
				var dday = dt.split('/')[0];
				var dmonth = dt.split('/')[1];
				if(dmonth-1 == monthDate) {
					var found = false;
					for(var k=0;k<selectedDates.length;k++) {						
						if(selectedDates[k].getDate() == dday) {
							selectedNames[k]+="\n"+dates[i].name;
							found = true;
							break;
						}
					}
					if(!found) {
						selectedDates.push(new Date(options.current.getFullYear(),monthDate,dday));
						selectedNames.push(dates[i].name);
					}
				}
			}
			if(selectedDates.length>0) {
				pickmeup('#cla').set_date(selectedDates);
				var allSelected = $('.pmu-days > .pmu-selected');
				for(var i=0;i<allSelected.length;i++) {
					var current = allSelected.eq(i);
					var strName = 'not found';
					for(var j=0;j<selectedDates.length;j++) {
						if(selectedDates[j].getDate() == current.text()) {
							current.attr('title', selectedNames[j]);
							break;
						}
					}
					current.attr({'data-toggle':'tooltip', 'data-placement':'bottom', 'trigger':'hover click'}).tooltip();
				}
			}
			else {
				pickmeup('#cla').clear();
			}
		}
		
		function showLiesFooter() {
			 var cookie = getCookie('perDay');			
			 if(!cookie) 
				return true;			 
			var parts = cookie.split(',expireDate=');
			var dt = Date.parse(parts[1]);
			var currentDate = new Date();
			if(dt > currentDate) {
				var number = parseInt(parts[0]);
				return number > 0;
			}
			return true;
		}
		
		
		function getCovidForSelectedDate() {
			  covidGetByDate(window.covidSelDate, function(dateStr, data) { renderDataForDate(dateStr, data, window.expUkFlag ? baseRegions : null );});
		}
		
		
		function renderDataForDate(dateStr, data, selectedRegions) {
			$('#covidLbl').html('COVID-19 Data ('+dateStr+')');
			if(!data)
				$('#covidGrid').html('<h6>No Data Available</h6>');
			else
				$('#covidGrid').html(buildCovidGrid(dateStr, data, selectedRegions));		
		}
		
		
		function buildCovidGrid(dateStr, data, selectedRegions) {
			let arr = [];
			let w = covidGetWorldTotal(data.world);
			let Ukraine = covidGetUkraineTotal(data.ukraine);
			
			if(selectedRegions) {
				for(let i=0;i<selectedRegions.length;i++) {
					let l = selectedRegions[i];
					let found = false;
					for(let j=0;j<data.ukraine.length;j++) {
						if(data.ukraine[j].label.en.indexOf(l) == 0) {
							arr.push(data.ukraine[j]);
							found = true;
						}
					}
					
					if(!found){
						for(let j=0;j<data.world.length;j++) {
							if(data.world[j].label.en.indexOf(l) == 0) {
								arr.push(data.world[j]);
								found = true;
							}
						}
					}
				
				}
			}
			else {
				for(let j=0;j<data.ukraine.length;j++)
					arr.push(data.ukraine[j]);
				arr.sort(function(a, b) {
				  var nameA = a.label.en.toUpperCase(); // ignore upper and lowercase
				  var nameB = b.label.en.toUpperCase(); // ignore upper and lowercase
				  if (nameA < nameB) {
					return -1;
				  }
				  if (nameA > nameB) {
					return 1;
				  }

				  // names must be equal
				  return 0;
				});
			}
			
			let html = '';
			html+='<div class="col-3 border">Region</div><div class="col-2 border">Confirmed</div><div class="col-2 border">Died</div><div class="col-2 border">Recovered</div><div class="col-2 border">Suspicion</div><div class="col-1 border">Hit %</div>';
			html+=getRow(w);
			html+=getRow(Ukraine);
			for(let i=0;i<arr.length;i++)
				html+= getRow(arr[i]);		
			
			return html;
		}
		
		function getRow(obj) {			
			var html='';
			
			
			if(obj.label2 == 'Ukraine')
				html+='<div class="col-3 border">Ukraine<br/><span id="expUk" class="'+(window.expUkFlag? "expoff" : "expon")+'" style="cursor:pointer">'+(window.expUkFlag? "(+)" : "(—)")+'</span></div>'
			else
				html+='<div class="col-3 border">'+(obj.label2 ? obj.label2 : obj.label.en )+'</div>'
				
				
			html+='<div class="col-2 border c19confirm">'+formatGrowth(obj.confirmed, obj.delta_confirmed)+'</div>';
			html+='<div class="col-2 border c19death">'+formatGrowth(obj.deaths, obj.delta_deaths)+'</div>';
			html+='<div class="col-2 border c19recover">'+formatGrowth(obj.recovered, obj.delta_recovered)+'</div>';
			if(obj.suspicion != 0) {
				html+='<div class="col-2 border c19suspicion">'+formatGrowth(obj.suspicion, obj.delta_suspicion)+'</div>';			
				html+='<div class="col-1 border c19tested">'+(100*obj.confirmed/obj.suspicion).toFixed(2)+'%</div>';
			}
			else {
				html+='<div class="col-2 border c19suspicion"></div><div class="col-1 c19tested border"></div>';
			}			
			return html;
		}
		
		function formatGrowth(n,d) {
			var str = n3(n) + '<br/>(';
			if(d < 0) {
				str+= n3(d);
				str+=' | ';
				str+= (100*d/(n-d)).toFixed(1);
				str+='%)';
			}
			else if(d==0) {
				str+='+0)';				
			}
			else {
				str+='+'+n3(d);
				str+=' | +';
				if(n == d)
					str+= "100%";
				else
					str+= (100*d/(n-d)).toFixed(1);
				
				str+='%)';
			}		
			
			return str;
		}
		
		function n3(x) {
			return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
		}
		
</script>
  </body>
</html>